<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Secure Password Generator</title>
    <link rel="icon" href="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%234caf50' /%3E%3C/svg%3E" type="image/svg+xml">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    input[type="text"],
    select {
      color: rgb(12, 141, 173);
      background-color: rgb(15, 15, 15);
      font-family: monospace;
      border: 1px solid rgb(52, 112, 240);
      padding: 4px;
      box-sizing: border-box;
    }

    input[type="text"] {
      width: 50ch;
      max-width: 100%;
    }

    select {
      appearance: none;
      -moz-appearance: none;
      -webkit-appearance: none;
    }

    select option {
      background-color: rgb(15, 15, 15) !important;
      color: rgb(12, 141, 173) !important;
    }

    label { display:block; margin: 8px 0; }

    button { 
      margin-right: 8px; 
      color: rgb(52, 112, 240); 
      background-color: rgb(42, 41, 43); 
      outline-color: rgb(32, 32, 32); 
      border: 1px solid rgb(52,112,240);
      padding: 6px 10px;
    }

    .note { 
      color: rgb(52,112,240); 
      font-size: 0.9em; 
      margin-top: 20px; 
    }

    .versions-list { 
      font-family: monospace; 
      white-space: pre; 
      background:rgb(15,15,15); 
      padding:20px; 
      border-radius:4px; 
    }

    body {
      background-color: rgb(49, 48, 48);
      color: rgb(52, 112, 240);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-attachment: fixed;
    }

    h1 { color: rgb(12, 141, 173); }

    #bgSelectorContainer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      padding: 10px;
      border-radius: 6px;
      border: 1px solid rgb(52,112,240);
    }

    #bgSelectorLabel {
      font-size: 0.85em;
      margin-bottom: 4px;
      display: block;
    }

    #backgroundSelect {
      width: auto;
    }
  </style>
</head>

<body>

  <audio id="bgHum" src="electricHum.mp3" loop></audio>

  <script>
  const humElement = document.getElementById("bgHum");

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const track = audioCtx.createMediaElementSource(humElement);

  const gainNode = audioCtx.createGain();
  gainNode.gain.value = -0.5;

  track.connect(gainNode).connect(audioCtx.destination);

  humElement.onerror = () => console.log("AUDIO FAILED TO LOAD");
  humElement.oncanplaythrough = () => console.log("AUDIO LOADED OK");

  function startHum() {
    audioCtx.resume();
    humElement.play().catch(err => console.log("Play blocked:", err));
    document.removeEventListener("click", startHum);
  }

  document.addEventListener("click", startHum);
</script>


  <h1>Secure Password Generatorüîê</h1>
  <h2>Generate secure passwords for your accounts!</h2>

  <label>
    Key:
    <input id="masterKey" type="text" autocomplete="off" size="50" />
  </label>

  <label>
    Name (i.e. username, linked email):
    <input id="accountName" type="text" autocomplete="off" size="50" />
  </label>

  <label>
    Version:
    <select id="versionSelect"></select>
  </label>

  <div>
    <button id="generateBtn">Generate password</button>
  </div>

  <br />

  <label>
    Generated password:
    <input id="passwordOutput" type="text" readonly />
  </label>

  <div>
    <button id="copyBtn">Copy password</button>
  </div>

  <div class="note">
    <strong>Available versions</strong>
    <div id="versionsList" class="versions-list" aria-live="polite"></div>
  </div>

  <div id="bgSelectorContainer">
    <label id="bgSelectorLabel">Background:</label>
    <select id="backgroundSelect"></select>
  </div>

  <script>
    const BACKGROUNDS = [
      "cyberBackground (Green1).png",
      "cyberBackground (Green2).png",
      "cyberBackground (Green3).png",
      "cyberBackground (Green4).png",
      "cyberBackground (Gray).png"
    ];

    const backgroundSelect = document.getElementById("backgroundSelect");

    function populateBackgroundDropdown() {
      BACKGROUNDS.forEach(bg => {
        const opt = document.createElement("option");
        opt.value = bg;
        const label = bg.replace(/\.[^/.]+$/, "");
        opt.textContent = label;
        backgroundSelect.appendChild(opt);
      });
      setBackground(BACKGROUNDS[0]);
      backgroundSelect.value = BACKGROUNDS[0];
    }

    function setBackground(filename) {
      document.body.style.backgroundImage = `url("Images/${filename}")`;
    }

    backgroundSelect.addEventListener("change", () => {
      setBackground(backgroundSelect.value);
    });

    populateBackgroundDropdown();

    const encoder = new TextEncoder();

    const VERSIONS = {
      "v1": {
        kdf: "PBKDF2",
        masterSalt: "my-app-master-salt-v1",
        masterIter: 250000,
        accountIter: 150000,
        hash: "SHA-256",
        charset: "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*_-+",
        length: 20
      }
    };

    const DEFAULT_VERSION = "v1";

    const versionSelect = document.getElementById("versionSelect");
    const versionsListEl = document.getElementById("versionsList");

    function refreshVersionUI() {
      versionSelect.innerHTML = "";
      const lines = [];

      Object.keys(VERSIONS).forEach(v => {
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        versionSelect.appendChild(opt);

        const p = VERSIONS[v];
        lines.push(
          `${v}: kdf=${p.kdf}; masterSalt="${p.masterSalt}"; masterIter=${p.masterIter}; accountIter=${p.accountIter}; hash=${p.hash}; len=${p.length}`
        );
      });

      versionSelect.value =
        DEFAULT_VERSION in VERSIONS
          ? DEFAULT_VERSION
          : Object.keys(VERSIONS)[0];

      versionsListEl.textContent = lines.join("\n");
    }

    refreshVersionUI();

    async function deriveBitsPBKDF2(passwordBytes, saltBytes, iterations, bitLength, hash) {
      const baseKey = await crypto.subtle.importKey(
        "raw",
        passwordBytes,
        { name: "PBKDF2" },
        false,
        ["deriveBits"]
      );

      const bits = await crypto.subtle.deriveBits(
        {
          name: "PBKDF2",
          hash: hash,
          salt: saltBytes,
          iterations: iterations
        },
        baseKey,
        bitLength
      );

      return new Uint8Array(bits);
    }

    function bytesToPassword(bytes, charset, length) {
      const chars = [];
      const charsetLength = charset.length;

      for (let i = 0; i < length; i++) {
        const b1 = bytes[(i * 2) % bytes.length];
        const b2 = bytes[(i * 2 + 1) % bytes.length];
        const combined = ((b1 << 8) | b2) >>> 0;
        const index = combined % charsetLength;
        chars.push(charset[index]);
      }

      return chars.join("");
    }

    async function generatePassword(Key, accountName, version) {
      if (!Key || !accountName || !version) {
        throw new Error("Key, account name, and version are required.");
      }

      const params = VERSIONS[version];
      if (!params) throw new Error("Unknown version: " + version);

      const masterSaltBytes = encoder.encode(params.masterSalt + "|" + version);

      const masterKeyBytes = await deriveBitsPBKDF2(
        encoder.encode(Key),
        masterSaltBytes,
        params.masterIter,
        256,
        params.hash
      );

      const accountSaltBytes = encoder.encode(version + "|" + accountName);

      const accountBits = await deriveBitsPBKDF2(
        masterKeyBytes,
        accountSaltBytes,
        params.accountIter,
        256,
        params.hash
      );

      return bytesToPassword(accountBits, params.charset, params.length);
    }

    document.getElementById("generateBtn").addEventListener("click", async () => {
      const Key = document.getElementById("masterKey").value.trim();
      const accountName = document.getElementById("accountName").value.trim();
      const version = document.getElementById("versionSelect").value;
      const output = document.getElementById("passwordOutput");

      output.value = "";

      try {
        const pwd = await generatePassword(Key, accountName, version);
        output.value = pwd;
      } catch (err) {
        alert("Error: " + err.message);
      }
    });

    document.getElementById("copyBtn").addEventListener("click", async () => {
      const out = document.getElementById("passwordOutput");
      if (!out.value) return;

      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(out.value);
        } else {
          out.select();
          document.execCommand("copy");
        }

        const btn = document.getElementById("copyBtn");
        const old = btn.textContent;
        btn.textContent = "Copied!";
        setTimeout(() => (btn.textContent = old), 1200);

      } catch (e) {
        alert("Copy failed");
      }
    });

    window.setDefaultVersion = function (v) {
      if (v in VERSIONS) {
        versionSelect.value = v;
      }
    };
  </script>

</body>
</html>







